/*! obop 0.0.12 */
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.obop=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(){return this instanceof d?void 0:new d}var e=a("./lib/dollar_where"),f=a("./lib/dollar_update");d.where=d.prototype.where=a("./lib/where.js").where,d.view=d.prototype.view=a("./lib/view.js").view,d.order=d.prototype.order=a("./lib/order.js").order,d.update=d.prototype.update=a("./lib/update.js").update,d.system=d.prototype.system=a("./lib/system.json"),d.$where=d.prototype.$where=new e,d.$update=d.prototype.$update=new f,b.exports=d},{"./lib/dollar_update":2,"./lib/dollar_where":3,"./lib/order.js":4,"./lib/system.json":5,"./lib/update.js":6,"./lib/view.js":7,"./lib/where.js":8}],2:[function(a,b,c){function d(){return this instanceof d?void 0:new d}b.exports=d,d.prototype={$set:function(a){return function(b){if("object"!=typeof b)return b;for(var c in a)b[c]=a[c];return b}},$unset:function(a){return function(b){if("object"!=typeof b)return b;for(var c in a)delete b[c];return b}},$rename:function(a){return function(b){if("object"!=typeof b)return b;for(var c in a){var d=b[c];if("undefined"!=typeof d){delete b[c];var e=a[c];b[e]=d}}return b}},$push:function(a){return function(b){if("object"!=typeof b)return b;for(var c in a){var d=a[c],e=b[c];e instanceof Array||("undefined"==typeof e?b[c]=[]:b[c]=[e]),b[c].push(d)}return b}},$pull:function(a){return function(b){if("object"!=typeof b)return b;for(var c in a){var d=a[c],e=b[c];if(e instanceof Array){for(var f=[],g=e.length,h=0;g>h;h++){var i=e[h];d!=i&&f.push(i)}b[c]=f}else d==e&&(b[c]=[])}return b}},$inc:function(a){return function(b){if("object"!=typeof b)return b;for(var c in a){var d=a[c],e=b[c];d=parseFloat(d)||0,e=parseFloat(e)||0,b[c]=e+d}return b}}}},{}],3:[function(a,b,c){function d(){return this instanceof d?void 0:new d}function e(a){for(var b=a.length,c=0;b>c;c++){var d=a[c];if(d instanceof Error)return d}}function f(a){var b=a.length;return e(a)||function(c){for(var d=0;b>d;d++){var e=a[d];if(!e(c))return!1}return!0}}function g(a){var b=a.length;return e(a)||function(c){for(var d=0;b>d;d++){var e=a[d];if(e(c))return!0}return!1}}b.exports=d,d.prototype={$gt:function(a){return function(b){return b>a}},$gte:function(a){return function(b){return b>=a}},$in:function(a){if(!(a instanceof Array))return new Error("invalid query");var b=a.length;return function(c){for(var d=0;b>d;d++)if(c==a[d])return!0;return!1}},$lt:function(a){return function(b){return a>b}},$lte:function(a){return function(b){return a>=b}},$ne:function(a){return function(b){return b!=a}},$nin:function(a){var b=a.length;return function(c){for(var d=0;b>d;d++)if(c==a[d])return!1;return!0}},$or:function(a,b){if(a){if(!(a instanceof Array)||0===a.length)return new Error("$or requires nonempty array");var c=[];return a.forEach(function(a){var d=b.where(a);c.push(d)}),g(c)}},$and:function(a,b){if(a){if(!(a instanceof Array)||0===a.length)return new Error("$and expression must be a nonempty array");var c=[];return a.forEach(function(a){var d=b.where(a);c.push(d)}),f(c)}},$not:function(a,b){var c=b.where(a);return function(a){return!c(a)}},$exists:function(a){return function(b){var c="undefined"!=typeof b;return c===a}},$size:function(a){return function(b){var c,d="undefined"!=typeof b;return d&&b instanceof Array?(c=b.length,c==a):!1}}}},{}],4:[function(a,b,c){function d(a){function b(a,b,d){function e(c,e){var f=c[a],g=e[a];return f>g?b:g>f?-b:f!==l&&g===l?b:f===l&&g!==l?-b:d?d(c,e):0}function f(a,b){var c=a[g],e=b[g],f=c&&"object"==typeof c,h=e&&"object"==typeof e;if(f||h){f||(c={}),h||(e={});var i=j(c,e);if(i)return i}return d?d(a,b):0}var g,h,i,j,k=a.indexOf(".");return k>-1?(g=a.substr(0,k),h=a.substr(k+1),i=[h,b],j=c.order([i]),f):e;var l}var c=this,d=null;if("function"==typeof a)return a;if(a=a||{},"object"!=typeof a)return new Error("Invalid order operator type: "+a);if(a instanceof Array){var e;if(a.forEach(function(a){e||a instanceof Array&&2===a.length&&"undefined"!=typeof a[0]&&a[1]-a[1]===0||(e=new Error("Invalid order pair: "+a))}),e)return e}else{var f=[];for(var g in a){var h=[g,a[g]];f.push(h)}a=f}var i=a.length;if(0===i)return d;for(var j,k=i-1;k>=0;k--)j=b(a[k][0],a[k][1],j);return j}c.order=function(a,b){var c,e=arguments.length;if(1==e){if(c=d.call(this,a),c instanceof Error)throw c;return c}if(2==e){if(a instanceof Array){if(c=d.call(this,b),c instanceof Error)throw c;return a.sort(c)}throw new Error("Invalid argument type: "+a)}throw new Error("Invalid arguments length: "+e)}},{}],5:[function(a,b,c){b.exports={name:"obop",version:"0.0.12"}},{}],6:[function(a,b,c){function d(a){var b,c=this,f=null;if("function"==typeof a)return a;if(a=a||{},!Object.keys(a))return f;if("object"!=typeof a)return new Error("Invalid update operator type: "+d);var g=[];return Object.keys(a).forEach(function(d){if(!b){var e=c.$update[d];if(!e)return void(b=new Error("Unknown update operator: "+d));var f=a[d],h={},i={};for(var j in f){var k=f[j],l=j.indexOf(".");if(l>-1){var m=j.substr(0,l),n=j.substr(l+1);i[m]=i[m]||{},i[m][n]=k}else h[j]=k}if(Object.keys(h).length){var o=e(h);g.push(o)}Object.keys(i).length&&Object.keys(i).forEach(function(a){var b={};b[d]=i[a];var e=c.update(b),f=function(b){var c=b[a];return"object"!=typeof c&&(c=b[a]={}),b[a]=e(c),b};g.push(f)})}}),b?b:g.length<2?g.shift()||f:e(g)}function e(a){var b=a.length;return function(c){for(var d=0;b>d;d++){var e=a[d];c=e(c)}return c}}c.update=function(a,b){var c,e=arguments.length;if(1==e){if(c=d.call(this,a),c instanceof Error)throw c;return c}if(2==e){if(a instanceof Array){if(c=d.call(this,b),c instanceof Error)throw c;return a.map(c)}throw new Error("Invalid argument type: "+a)}throw new Error("Invalid arguments length: "+e)}},{}],7:[function(a,b,c){function d(a){function b(a){var b={};return a.hasOwnProperty(l)&&(b[l]=a[l]),b}function c(a){var b={};return Object.keys(a).forEach(function(c){n[c]||(b[c]=a[c])}),b}function d(a){var b={};return Object.keys(a).forEach(function(c){m[c]&&(b[c]=a[c])}),b}function e(a){var b={};return Object.keys(a).forEach(function(c){var d=n[c],e=a[c];"function"==typeof d?"object"==typeof e?b[c]=d(e):b[c]=e:d||(b[c]=e)}),b}function f(a){var b={};return Object.keys(a).forEach(function(c){var d=m[c],e=a[c];"function"==typeof d?"object"==typeof e&&(b[c]=d(e)):d&&(b[c]=e)}),b}function g(a){return v&&(a=f(a)),w&&(a=e(a)),a}var h=this,i=null;if("function"==typeof a)return a;if(a=a||{},"object"!=typeof a)return new Error("Invalid view parameters type: "+a);var j=Object.keys(a);if(!j.length)return i;var k,l=j[0],m={},n={},o={},p={};for(var q in a){var r=a[q],s=q.indexOf(".");if(s>-1){var t=q.substr(0,s),u=q.substr(s+1);k=!0,r?(o[t]=o[t]||{},o[t][u]=r):(p[t]=p[t]||{},p[t][u]=r)}else r?m[q]=!0:n[q]=!0}k&&(Object.keys(o).forEach(function(a){var b=o[a];m[a]=h.view(b)}),Object.keys(p).forEach(function(a){var b=p[a];n[a]=h.view(b)}));var v=Object.keys(m).length,w=Object.keys(n).length;return 1!==v||w||k?v&&!w?k?f:d:!v&&w?k?e:c:g:b}c.view=function(a,b){var c,e=arguments.length;if(1==e){if(c=d.call(this,a),c instanceof Error)throw c;return c}if(2==e){if(a instanceof Array){if(c=d.call(this,b),c instanceof Error)throw c;return a.map(c)}throw new Error("Invalid argument type: "+a)}throw new Error("Invalid arguments length: "+e)}},{}],8:[function(a,b,c){function d(a){function b(a){Object.keys(a).forEach(function(b){if(!v){var d=a[b],f=c.where(d);if(f){if(f instanceof Error)return void(v=f);var g=function(a){return f(a[b])};g&&e.push(g)}}})}var c=this,d=null;if("function"==typeof a)return a;if(a=a||{},"object"!=typeof a)return new Error("Invalid where operator type: "+a);var e=[],g={},h={},i={};for(var j in a){var k=a[j],l=j.indexOf("."),m=c.$where[j];if(m){var n=m(k,c,j);n&&e.push(n)}else if(l>-1){var o=j.substr(0,l),p=j.substr(l+1);h[o]=h[o]||{},h[o][p]=k}else{if(k instanceof Array)return new Error("Unknown where operator: "+j);"object"==typeof k?i[j]=k:g[j]=k}}var q=Object.keys(g);if(1==q.length){var r=q[0],s=a[r],t=function(a){return"object"==typeof a&&a[r]==s};e.push(t)}else if(q.length>1){var u=function(a){if("object"!=typeof a)return!1;for(var b in g)if(a[b]!=g[b])return!1;return!0};e.push(u)}var v;return b(h),b(i),v?new Error(v):e.length<2?e.shift()||d:f(e)}function e(a){for(var b=a.length,c=0;b>c;c++){var d=a[c];if(d instanceof Error)return d}}function f(a){var b=a.length;return e(a)||function(c){for(var d=0;b>d;d++){var e=a[d];if(!e(c))return!1}return!0}}c.where=function(a,b){var c,e=arguments.length;if(1==e){if(c=d.call(this,a),c instanceof Error)throw c;return c}if(2==e){if(a instanceof Array){if(c=d.call(this,b),c instanceof Error)throw c;return a.filter(c)}throw new Error("Invalid argument type: "+a)}throw new Error("Invalid arguments length: "+e)}},{}]},{},[1])(1)});