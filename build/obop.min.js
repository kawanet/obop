!function(r){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=r();else if("function"==typeof define&&define.amd)define([],r);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).obop=r()}}((function(){return function r(n,t,e){function o(f,u){if(!t[f]){if(!n[f]){var a="function"==typeof require&&require;if(!u&&a)return a(f,!0);if(i)return i(f,!0);var c=new Error("Cannot find module '"+f+"'");throw c.code="MODULE_NOT_FOUND",c}var s=t[f]={exports:{}};n[f][0].call(s.exports,(function(r){return o(n[f][1][r]||r)}),s,s.exports,r,n,t,e)}return t[f].exports}for(var i="function"==typeof require&&require,f=0;f<e.length;f++)o(e[f]);return o}({1:[function(r,n,t){var e=r("./lib/dollar_where"),o=r("./lib/dollar_update");function i(){if(!(this instanceof i))return new i}i.where=i.prototype.where=r("./lib/where.js").where,i.view=i.prototype.view=r("./lib/view.js").view,i.order=i.prototype.order=r("./lib/order.js").order,i.update=i.prototype.update=r("./lib/update.js").update,i.system=i.prototype.system=r("./lib/system.json"),i.$where=i.prototype.$where=new e,i.$update=i.prototype.$update=new o,n.exports=i},{"./lib/dollar_update":2,"./lib/dollar_where":3,"./lib/order.js":4,"./lib/system.json":5,"./lib/update.js":6,"./lib/view.js":7,"./lib/where.js":8}],2:[function(r,n,t){function e(){if(!(this instanceof e))return new e}n.exports=e,e.prototype={$set:function(r){return function(n){if("object"!=typeof n)return n;for(var t in r)n[t]=r[t];return n}},$unset:function(r){return function(n){if("object"!=typeof n)return n;for(var t in r)delete n[t];return n}},$rename:function(r){return function(n){if("object"!=typeof n)return n;for(var t in r){var e=n[t];if(void 0!==e)delete n[t],n[r[t]]=e}return n}},$push:function(r){return function(n){if("object"!=typeof n)return n;for(var t in r){var e=r[t],o=n[t];o instanceof Array||(n[t]=void 0===o?[]:[o]),n[t].push(e)}return n}},$pull:function(r){return function(n){if("object"!=typeof n)return n;for(var t in r){var e=r[t],o=n[t];if(o instanceof Array){for(var i=[],f=o.length,u=0;u<f;u++){var a=o[u];e!=a&&i.push(a)}n[t]=i}else e==o&&(n[t]=[])}return n}},$inc:function(r){return function(n){if("object"!=typeof n)return n;for(var t in r){var e=r[t],o=n[t];e=parseFloat(e)||0,o=parseFloat(o)||0,n[t]=o+e}return n}}}},{}],3:[function(r,n,t){function e(){if(!(this instanceof e))return new e}function o(r){for(var n=r.length,t=0;t<n;t++){var e=r[t];if(e instanceof Error)return e}}n.exports=e,e.prototype={$gt:function(r){return function(n){return n>r}},$gte:function(r){return function(n){return n>=r}},$in:function(r){if(!(r instanceof Array))return new Error("invalid query");var n=r.length;return function(t){for(var e=0;e<n;e++)if(t==r[e])return!0;return!1}},$lt:function(r){return function(n){return n<r}},$lte:function(r){return function(n){return n<=r}},$ne:function(r){return function(n){return n!=r}},$nin:function(r){var n=r.length;return function(t){for(var e=0;e<n;e++)if(t==r[e])return!1;return!0}},$or:function(r,n){if(r){if(!(r instanceof Array)||0===r.length)return new Error("$or requires nonempty array");var t,e,i=[];return r.forEach((function(r){var t=n.where(r);i.push(t)})),e=(t=i).length,o(t)||function(r){for(var n=0;n<e;n++)if((0,t[n])(r))return!0;return!1}}},$and:function(r,n){if(r){if(!(r instanceof Array)||0===r.length)return new Error("$and expression must be a nonempty array");var t,e,i=[];return r.forEach((function(r){var t=n.where(r);i.push(t)})),e=(t=i).length,o(t)||function(r){for(var n=0;n<e;n++)if(!(0,t[n])(r))return!1;return!0}}},$not:function(r,n){var t=n.where(r);return function(r){return!t(r)}},$exists:function(r){return function(n){return void 0!==n===r}},$size:function(r){return function(n){return void 0!==n&&(n instanceof Array&&n.length===r)}}}},{}],4:[function(r,n,t){function e(r){var n=this;if("function"==typeof r)return r;if("object"!=typeof(r=r||{}))return new Error("Invalid order operator type: "+r);if(r instanceof Array){var t;if(r.forEach((function(r){t||r instanceof Array&&2===r.length&&void 0!==r[0]&&r[1]-r[1]==0||(t=new Error("Invalid order pair: "+r))})),t)return t}else{var e=[];for(var o in r){if(/(^|\.)__proto__(\.|$)/.test(o))return new Error("Invalid target: "+o);var i=[o,r[o]];e.push(i)}r=e}var f,u=r.length;if(0===u)return null;for(var a=u-1;a>=0;a--)f=c(r[a][0],r[a][1],f);return f;function c(r,t,e){var o,i,f,u,a=r.indexOf(".");return a>-1?(o=r.substr(0,a),i=[r.substr(a+1),t],f=n.order([i]),function(r,n){var t=r[o],i=n[o],u=t&&"object"==typeof t,a=i&&"object"==typeof i;if(u||a){u||(t={}),a||(i={});var c=f(t,i);if(c)return c}return e?e(r,n):0}):function(n,o){var i=n[r],f=o[r];return i>f?t:i<f?-t:i!==u&&f===u?t:i===u&&f!==u?-t:e?e(n,o):0}}}t.order=function(r,n){var t,o=arguments.length;if(1===o){if((t=e.call(this,r))instanceof Error)throw t;return t}if(2===o){if(r instanceof Array){if((t=e.call(this,n))instanceof Error)throw t;return r.sort(t)}throw new Error("Invalid argument type: "+r)}throw new Error("Invalid arguments length: "+o)}},{}],5:[function(r,n,t){n.exports={name:"obop",version:"0.2.3"}},{}],6:[function(r,n,t){function e(r){var n,t=this;if("function"==typeof r)return r;if(r=r||{},!Object.keys(r))return null;if("object"!=typeof r)return new Error("Invalid update operator type: "+e);var o=[];return Object.keys(r).forEach((function(e){if(!n){var i=t.$update[e];if(i){var f=r[e],u={},a={};for(var c in f){if(/(^|\.)__proto__(\.|$)/.test(c))return void(n=new Error("Invalid target: "+c));var s=f[c],l=c.indexOf(".");if(l>-1){var v=c.substr(0,l),p=c.substr(l+1);a[v]=a[v]||{},a[v][p]=s}else u[c]=s}if(Object.keys(u).length){var h=i(u);o.push(h)}Object.keys(a).length&&Object.keys(a).forEach((function(r){var n={};n[e]=a[r];var i=t.update(n);o.push((function(n){var t=n[r];return"object"!=typeof t&&(t=n[r]={}),n[r]=i(t),n}))}))}else n=new Error("Unknown update operator: "+e)}})),n||(o.length<2?o.shift()||null:function(r){var n=r.length;return function(t){for(var e=0;e<n;e++){t=(0,r[e])(t)}return t}}(o))}t.update=function(r,n){var t,o=arguments.length;if(1===o){if((t=e.call(this,r))instanceof Error)throw t;return t}if(2===o){if(r instanceof Array){if((t=e.call(this,n))instanceof Error)throw t;return r.map(t)}throw new Error("Invalid argument type: "+r)}throw new Error("Invalid arguments length: "+o)}},{}],7:[function(r,n,t){function e(r){var n=this;if("function"==typeof r)return r;if("object"!=typeof(r=r||{}))return new Error("Invalid view parameters type: "+r);var t=Object.keys(r);if(!t.length)return null;var e,o=t[0],i={},f={},u={},a={};for(var c in r){if(/(^|\.)__proto__(\.|$)/.test(c))return new Error("Invalid target: "+c);var s=r[c],l=c.indexOf(".");if(l>-1){var v=c.substr(0,l),p=c.substr(l+1);e=!0,s?(u[v]=u[v]||{},u[v][p]=s):(a[v]=a[v]||{},a[v][p]=s)}else s?i[c]=!0:f[c]=!0}e&&(Object.keys(u).forEach((function(r){var t=u[r];i[r]=n.view(t)})),Object.keys(a).forEach((function(r){var t=a[r];f[r]=n.view(t)})));var h=Object.keys(i).length,y=Object.keys(f).length;return 1!==h||y||e?h&&!y?e?w:function(r){var n={};return Object.keys(r).forEach((function(t){i[t]&&(n[t]=r[t])})),n}:!h&&y?e?d:function(r){var n={};return Object.keys(r).forEach((function(t){f[t]||(n[t]=r[t])})),n}:function(r){h&&(r=w(r));y&&(r=d(r));return r}:function(r){var n={};r.hasOwnProperty(o)&&(n[o]=r[o]);return n};function d(r){var n={};return Object.keys(r).forEach((function(t){var e=f[t],o=r[t];"function"==typeof e?n[t]="object"==typeof o?e(o):o:e||(n[t]=o)})),n}function w(r){var n={};return Object.keys(r).forEach((function(t){var e=i[t],o=r[t];"function"==typeof e?"object"==typeof o&&(n[t]=e(o)):e&&(n[t]=o)})),n}}t.view=function(r,n){var t,o=arguments.length;if(1===o){if((t=e.call(this,r))instanceof Error)throw t;return t}if(2===o){if(r instanceof Array){if((t=e.call(this,n))instanceof Error)throw t;return r.map(t)}throw new Error("Invalid argument type: "+r)}throw new Error("Invalid arguments length: "+o)}},{}],8:[function(r,n,t){function e(r){var n=this;if("function"==typeof r)return r;if("object"!=typeof(r=r||{}))return new Error("Invalid where operator type: "+r);var t=[],e={},o={},i={};for(var f in r){if(/(^|\.)__proto__(\.|$)/.test(f))return new Error("Invalid target: "+f);var u=r[f],a=f.indexOf("."),c=n.$where[f];if(c){var s=c(u,n,f);s&&t.push(s)}else if(a>-1){var l=f.substr(0,a),v=f.substr(a+1);o[l]=o[l]||{},o[l][v]=u}else{if(u instanceof Array)return new Error("Unknown where operator: "+f);"object"==typeof u?i[f]=u:e[f]=u}}var p,h=Object.keys(e);if(1===h.length){var y=h[0],d=r[y];t.push((function(r){return"object"==typeof r&&r[y]==d}))}else if(h.length>1){t.push((function(r){if("object"!=typeof r)return!1;for(var n in e)if(r[n]!=e[n])return!1;return!0}))}return w(o),w(i),p?new Error(p):t.length<2?t.shift()||null:function(r){var n=r.length;return function(r){for(var n=r.length,t=0;t<n;t++){var e=r[t];if(e instanceof Error)return e}}(r)||function(t){for(var e=0;e<n;e++){if(!(0,r[e])(t))return!1}return!0}}(t);function w(r){Object.keys(r).forEach((function(e){if(!p){var o=r[e],i=n.where(o);if(i)if(i instanceof Error)p=i;else{var f=function(r){return i(r?r[e]:void 0)};f&&t.push(f)}}}))}}t.where=function(r,n){var t,o=arguments.length;if(1===o){if((t=e.call(this,r))instanceof Error)throw t;return t}if(2===o){if(r instanceof Array){if((t=e.call(this,n))instanceof Error)throw t;return r.filter(t)}throw new Error("Invalid argument type: "+r)}throw new Error("Invalid arguments length: "+o)}},{}]},{},[1])(1)}));