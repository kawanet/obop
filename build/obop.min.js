!function(r){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=r();else if("function"==typeof define&&define.amd)define([],r);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).obop=r()}}((function(){return function r(n,e,t){function o(f,u){if(!e[f]){if(!n[f]){var a="function"==typeof require&&require;if(!u&&a)return a(f,!0);if(i)return i(f,!0);var c=new Error("Cannot find module '"+f+"'");throw c.code="MODULE_NOT_FOUND",c}var s=e[f]={exports:{}};n[f][0].call(s.exports,(function(r){return o(n[f][1][r]||r)}),s,s.exports,r,n,e,t)}return e[f].exports}for(var i="function"==typeof require&&require,f=0;f<t.length;f++)o(t[f]);return o}({1:[function(r,n,e){var t=r("./lib/dollar_where"),o=r("./lib/dollar_update");function i(){if(!(this instanceof i))return new i}i.where=i.prototype.where=r("./lib/where.js").where,i.view=i.prototype.view=r("./lib/view.js").view,i.order=i.prototype.order=r("./lib/order.js").order,i.update=i.prototype.update=r("./lib/update.js").update,i.system=i.prototype.system=r("./lib/system.json"),i.$where=i.prototype.$where=new t,i.$update=i.prototype.$update=new o,n.exports=i},{"./lib/dollar_update":2,"./lib/dollar_where":3,"./lib/order.js":4,"./lib/system.json":5,"./lib/update.js":6,"./lib/view.js":7,"./lib/where.js":8}],2:[function(r,n,e){function t(){if(!(this instanceof t))return new t}n.exports=t,t.prototype={$set:function(r){return function(n){if("object"!=typeof n)return n;for(var e in r)n[e]=r[e];return n}},$unset:function(r){return function(n){if("object"!=typeof n)return n;for(var e in r)delete n[e];return n}},$rename:function(r){return function(n){if("object"!=typeof n)return n;for(var e in r){var t=n[e];if(void 0!==t)delete n[e],n[r[e]]=t}return n}},$push:function(r){return function(n){if("object"!=typeof n)return n;for(var e in r){var t=r[e],o=n[e];o instanceof Array||(n[e]=void 0===o?[]:[o]),n[e].push(t)}return n}},$pull:function(r){return function(n){if("object"!=typeof n)return n;for(var e in r){var t=r[e],o=n[e];if(o instanceof Array){for(var i=[],f=o.length,u=0;u<f;u++){var a=o[u];t!=a&&i.push(a)}n[e]=i}else t==o&&(n[e]=[])}return n}},$inc:function(r){return function(n){if("object"!=typeof n)return n;for(var e in r){var t=r[e],o=n[e];t=parseFloat(t)||0,o=parseFloat(o)||0,n[e]=o+t}return n}}}},{}],3:[function(r,n,e){function t(){if(!(this instanceof t))return new t}function o(r){for(var n=r.length,e=0;e<n;e++){var t=r[e];if(t instanceof Error)return t}}n.exports=t,t.prototype={$gt:function(r){return function(n){return n>r}},$gte:function(r){return function(n){return n>=r}},$in:function(r){if(!(r instanceof Array))return new Error("invalid query");var n=r.length;return function(e){for(var t=0;t<n;t++)if(e==r[t])return!0;return!1}},$lt:function(r){return function(n){return n<r}},$lte:function(r){return function(n){return n<=r}},$ne:function(r){return function(n){return n!=r}},$nin:function(r){var n=r.length;return function(e){for(var t=0;t<n;t++)if(e==r[t])return!1;return!0}},$or:function(r,n){if(r){if(!(r instanceof Array)||0===r.length)return new Error("$or requires nonempty array");var e,t,i=[];return r.forEach((function(r){var e=n.where(r);i.push(e)})),t=(e=i).length,o(e)||function(r){for(var n=0;n<t;n++)if((0,e[n])(r))return!0;return!1}}},$and:function(r,n){if(r){if(!(r instanceof Array)||0===r.length)return new Error("$and expression must be a nonempty array");var e,t,i=[];return r.forEach((function(r){var e=n.where(r);i.push(e)})),t=(e=i).length,o(e)||function(r){for(var n=0;n<t;n++)if(!(0,e[n])(r))return!1;return!0}}},$not:function(r,n){var e=n.where(r);return function(r){return!e(r)}},$exists:function(r){return function(n){return void 0!==n===r}},$size:function(r){return function(n){return void 0!==n&&(n instanceof Array&&n.length==r)}}}},{}],4:[function(r,n,e){e.order=function(r,n){var e,o=arguments.length;if(1==o){if((e=t.call(this,r))instanceof Error)throw e;return e}if(2==o){if(r instanceof Array){if((e=t.call(this,n))instanceof Error)throw e;return r.sort(e)}throw new Error("Invalid argument type: "+r)}throw new Error("Invalid arguments length: "+o)};function t(r){var n=this;if("function"==typeof r)return r;if("object"!=typeof(r=r||{}))return new Error("Invalid order operator type: "+r);if(r instanceof Array){var e;if(r.forEach((function(r){e||r instanceof Array&&2===r.length&&void 0!==r[0]&&r[1]-r[1]==0||(e=new Error("Invalid order pair: "+r))})),e)return e}else{var t=[];for(var o in r){var i=[o,r[o]];t.push(i)}r=t}var f,u=r.length;if(0===u)return null;for(var a=u-1;a>=0;a--)f=c(r[a][0],r[a][1],f);return f;function c(r,e,t){var o,i,f,u,a=r.indexOf(".");return a>-1?(o=r.substr(0,a),i=[r.substr(a+1),e],f=n.order([i]),function(r,n){var e=r[o],i=n[o],u=e&&"object"==typeof e,a=i&&"object"==typeof i;if(u||a){u||(e={}),a||(i={});var c=f(e,i);if(c)return c}return t?t(r,n):0}):function(n,o){var i=n[r],f=o[r];return i>f?e:i<f?-e:i!==u&&f===u?e:i===u&&f!==u?-e:t?t(n,o):0}}}},{}],5:[function(r,n,e){n.exports={name:"obop",version:"0.2.1"}},{}],6:[function(r,n,e){function t(r){var n,e=this;if("function"==typeof r)return r;if(r=r||{},!Object.keys(r))return null;if("object"!=typeof r)return new Error("Invalid update operator type: "+t);var o=[];return Object.keys(r).forEach((function(t){if(!n){var i=e.$update[t];if(i){var f=r[t],u={},a={};for(var c in f){var s=f[c],l=c.indexOf(".");if(l>-1){var v=c.substr(0,l),p=c.substr(l+1);a[v]=a[v]||{},a[v][p]=s}else u[c]=s}if(Object.keys(u).length){var h=i(u);o.push(h)}Object.keys(a).length&&Object.keys(a).forEach((function(r){var n={};n[t]=a[r];var i=e.update(n);o.push((function(n){var e=n[r];return"object"!=typeof e&&(e=n[r]={}),n[r]=i(e),n}))}))}else n=new Error("Unknown update operator: "+t)}})),n||(o.length<2?o.shift()||null:function(r){var n=r.length;return function(e){for(var t=0;t<n;t++){e=(0,r[t])(e)}return e}}(o))}e.update=function(r,n){var e,o=arguments.length;if(1==o){if((e=t.call(this,r))instanceof Error)throw e;return e}if(2==o){if(r instanceof Array){if((e=t.call(this,n))instanceof Error)throw e;return r.map(e)}throw new Error("Invalid argument type: "+r)}throw new Error("Invalid arguments length: "+o)}},{}],7:[function(r,n,e){function t(r){var n=this;if("function"==typeof r)return r;if("object"!=typeof(r=r||{}))return new Error("Invalid view parameters type: "+r);var e=Object.keys(r);if(!e.length)return null;var t,o=e[0],i={},f={},u={},a={};for(var c in r){var s=r[c],l=c.indexOf(".");if(l>-1){var v=c.substr(0,l),p=c.substr(l+1);t=!0,s?(u[v]=u[v]||{},u[v][p]=s):(a[v]=a[v]||{},a[v][p]=s)}else s?i[c]=!0:f[c]=!0}t&&(Object.keys(u).forEach((function(r){var e=u[r];i[r]=n.view(e)})),Object.keys(a).forEach((function(r){var e=a[r];f[r]=n.view(e)})));var h=Object.keys(i).length,y=Object.keys(f).length;return 1!==h||y||t?h&&!y?t?d:function(r){var n={};return Object.keys(r).forEach((function(e){i[e]&&(n[e]=r[e])})),n}:!h&&y?t?w:function(r){var n={};return Object.keys(r).forEach((function(e){f[e]||(n[e]=r[e])})),n}:function(r){h&&(r=d(r));y&&(r=w(r));return r}:function(r){var n={};r.hasOwnProperty(o)&&(n[o]=r[o]);return n};function w(r){var n={};return Object.keys(r).forEach((function(e){var t=f[e],o=r[e];"function"==typeof t?n[e]="object"==typeof o?t(o):o:t||(n[e]=o)})),n}function d(r){var n={};return Object.keys(r).forEach((function(e){var t=i[e],o=r[e];"function"==typeof t?"object"==typeof o&&(n[e]=t(o)):t&&(n[e]=o)})),n}}e.view=function(r,n){var e,o=arguments.length;if(1==o){if((e=t.call(this,r))instanceof Error)throw e;return e}if(2==o){if(r instanceof Array){if((e=t.call(this,n))instanceof Error)throw e;return r.map(e)}throw new Error("Invalid argument type: "+r)}throw new Error("Invalid arguments length: "+o)}},{}],8:[function(r,n,e){function t(r){var n=this;if("function"==typeof r)return r;if("object"!=typeof(r=r||{}))return new Error("Invalid where operator type: "+r);var e=[],t={},o={},i={};for(var f in r){var u=r[f],a=f.indexOf("."),c=n.$where[f];if(c){var s=c(u,n,f);s&&e.push(s)}else if(a>-1){var l=f.substr(0,a),v=f.substr(a+1);o[l]=o[l]||{},o[l][v]=u}else{if(u instanceof Array)return new Error("Unknown where operator: "+f);"object"==typeof u?i[f]=u:t[f]=u}}var p,h=Object.keys(t);if(1==h.length){var y=h[0],w=r[y];e.push((function(r){return"object"==typeof r&&r[y]==w}))}else if(h.length>1){e.push((function(r){if("object"!=typeof r)return!1;for(var n in t)if(r[n]!=t[n])return!1;return!0}))}return d(o),d(i),p?new Error(p):e.length<2?e.shift()||null:function(r){var n=r.length;return function(r){for(var n=r.length,e=0;e<n;e++){var t=r[e];if(t instanceof Error)return t}}(r)||function(e){for(var t=0;t<n;t++){if(!(0,r[t])(e))return!1}return!0}}(e);function d(r){Object.keys(r).forEach((function(t){if(!p){var o=r[t],i=n.where(o);if(i)if(i instanceof Error)p=i;else{var f=function(r){return i(r?r[t]:void 0)};f&&e.push(f)}}}))}}e.where=function(r,n){var e,o=arguments.length;if(1==o){if((e=t.call(this,r))instanceof Error)throw e;return e}if(2==o){if(r instanceof Array){if((e=t.call(this,n))instanceof Error)throw e;return r.filter(e)}throw new Error("Invalid argument type: "+r)}throw new Error("Invalid arguments length: "+o)}},{}]},{},[1])(1)}));